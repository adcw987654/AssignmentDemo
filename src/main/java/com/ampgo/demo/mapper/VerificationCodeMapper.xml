<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ampgo.demo.mapper.VerificationCodeMapper">

    <insert id="insert" parameterType="com.ampgo.demo.entity.VerificationCodeEntity" useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO verification_code (email, code, expiration_time, verified, create_time)
        VALUES (#{email}, #{code}, #{expirationTime}, #{verified}, #{createTime})
    </insert>

    <select id="findByEmailAndCode" resultType="com.ampgo.demo.entity.VerificationCodeEntity">
        SELECT id, email, code, expiration_time as expirationTime, verified, create_time as createTime
        FROM verification_code
        WHERE email = #{email} AND code = #{code} AND verified = 0
        ORDER BY create_time DESC
        LIMIT 1
    </select>

    <update id="updateVerified">
        UPDATE verification_code
        SET verified = 1
        WHERE id = #{id}
    </update>
</mapper>
